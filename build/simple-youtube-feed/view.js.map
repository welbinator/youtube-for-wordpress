{"version":3,"file":"simple-youtube-feed/view.js","mappings":"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","sources":["webpack://youtube-for-wordpress/./src/simple-youtube-feed/view.js"],"sourcesContent":["document.addEventListener(\"DOMContentLoaded\", async () => {\n    const container = document.getElementById(\"youtube-feed-container\");\n\n    // Ensure container is available and not already initialized\n    if (!container) {\n        console.warn(\"YouTube feed container not found.\");\n        return;\n    }\n\n    if (container.hasAttribute('data-initialized')) {\n        return;\n    }\n\n    container.setAttribute('data-initialized', 'true');\n\n    const enableSearch = container.getAttribute('data-enable-search') === 'true';\n    const layout = container.getAttribute('data-layout') || 'grid';\n    const maxVideos = parseInt(container.getAttribute('data-max-videos'), 10) || 10;\n    const selectedPlaylist = container.getAttribute('data-selected-playlist');\n    const apiUrlBase = `https://www.googleapis.com/youtube/v3`;\n\n    // Async function to fetch videos, with persistent caching using WordPress transients\n    async function fetchVideos(searchQuery = '') {\n        try {\n            // Create a unique cache key based on search query, playlist, and max videos\n            const cacheKey = `youtube_videos_${searchQuery}_${selectedPlaylist}_${maxVideos}`;\n            \n            // Check if cached videos exist\n            let cachedVideos = await fetch(`/wp-json/yt-for-wp/v1/get_cached_videos?key=${encodeURIComponent(cacheKey)}`)\n                .then(res => res.json());\n\n            if (cachedVideos && cachedVideos.length > 0) {\n                return cachedVideos;\n            }\n\n            // Construct API URL if no cached data found\n            let apiUrl = `${apiUrlBase}/search?part=snippet&type=video&channelId=${YT_FOR_WP.channelId}&maxResults=${maxVideos}&key=${YT_FOR_WP.apiKey}`;\n            if (selectedPlaylist) {\n                apiUrl = `${apiUrlBase}/playlistItems?part=snippet&maxResults=${maxVideos}&playlistId=${selectedPlaylist}&key=${YT_FOR_WP.apiKey}`;\n            }\n            if (searchQuery) {\n                apiUrl += `&q=${encodeURIComponent(searchQuery)}`;\n            }\n\n            const response = await fetch(apiUrl);\n            const data = await response.json();\n\n            // Cache the response using a custom REST endpoint\n            await fetch('/wp-json/yt-for-wp/v1/cache_videos', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ key: cacheKey, videos: data.items || [] })\n            });\n\n            return data.items || [];\n        } catch (error) {\n            console.error(\"Error fetching videos:\", error);\n            return [];\n        }\n    }\n\n    // Render the search bar if enabled\n    if (enableSearch) {\n        const searchContainer = document.createElement(\"div\");\n        searchContainer.classList.add(\"youtube-search-container\");\n\n        const searchBar = document.createElement(\"input\");\n        searchBar.type = \"text\";\n        searchBar.placeholder = \"Search videos\";\n        searchBar.classList.add(\"youtube-search-bar\");\n\n        const searchButton = document.createElement(\"button\");\n        searchButton.textContent = \"Search\";\n        searchButton.classList.add(\"youtube-search-button\");\n\n        searchBar.addEventListener(\"keypress\", (event) => {\n            if (event.key === \"Enter\") {\n                event.preventDefault(); // Prevent form submission if inside a form\n                searchButton.click(); // Trigger search button click\n            }\n        });\n\n        searchButton.addEventListener(\"click\", async () => {\n            const keyword = searchBar.value.trim();\n            if (keyword) {\n                const videos = await fetchVideos(keyword);\n                renderVideos(container, videos, layout);\n            }\n        });\n\n        searchContainer.appendChild(searchBar);\n        searchContainer.appendChild(searchButton);\n        container.appendChild(searchContainer);\n    }\n\n    // Initial video load, check if cached before calling API\n    const initialVideos = await fetchVideos();\n    renderVideos(container, initialVideos, layout);\n});\n\nfunction renderVideos(container, videos, layout) {\n    // Clear out any existing videos without affecting the search bar\n    const existingVideoContainer = container.querySelector(\".video-container\");\n    if (existingVideoContainer) {\n        existingVideoContainer.remove();\n    }\n\n    const videoContainer = document.createElement(\"div\");\n    videoContainer.classList.add(\"video-container\", layout === \"grid\" ? \"youtube-feed-grid\" : \"youtube-feed-list\");\n    container.appendChild(videoContainer);\n\n    videos.forEach(video => {\n        const videoElement = document.createElement(\"div\");\n        videoElement.classList.add(layout === \"grid\" ? \"youtube-video-grid-item\" : \"youtube-video-list-item\");\n\n        const title = video.snippet.title;\n        const description = video.snippet.description;\n        const videoId = video.id.videoId || video.snippet.resourceId?.videoId;\n        const videoUrl = `https://www.youtube.com/embed/${videoId}?vq=hd720`;\n\n        videoElement.innerHTML = `\n            <div class=\"video-iframe-wrapper\">\n                <iframe\n                    src=\"${videoUrl}\"\n                    title=\"${title}\"\n                    class=\"video-iframe\"\n                    allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                    allowfullscreen\n                ></iframe>\n            </div>\n            <div class=\"video-info\">\n                <h2 class=\"video-title\">${title}</h2>\n                <p class=\"video-description\">${description}</p>\n            </div>\n        `;\n\n        videoContainer.appendChild(videoElement);\n    });\n}\n\nfunction renderCarouselLayout(container, videos) {\n    container.innerHTML = `\n        <div class=\"swiper-container\">\n            <div class=\"swiper-wrapper\">\n                ${videos.map(video => `\n                    <div class=\"swiper-slide\">\n                        <iframe\n                            src=\"https://www.youtube.com/embed/${video.id.videoId || video.snippet.resourceId?.videoId}?vq=hd720\"\n                            title=\"${video.snippet.title}\"\n                            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                            allowfullscreen\n                        ></iframe>\n                        <div class=\"video-info\">\n                            <h2 class=\"video-title\">${video.snippet.title}</h2>\n                            <p class=\"video-description\">${video.snippet.description}</p>\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"swiper-pagination\"></div>\n            <div class=\"swiper-button-next\"></div>\n            <div class=\"swiper-button-prev\"></div>\n        </div>\n    `;\n\n    new Swiper('.swiper-container', {\n        slidesPerView: 1,\n        spaceBetween: 10,\n        navigation: {\n            nextEl: '.swiper-button-next',\n            prevEl: '.swiper-button-prev',\n        },\n        pagination: {\n            el: '.swiper-pagination',\n            clickable: true,\n        },\n        loop: true,\n        breakpoints: {\n            640: { slidesPerView: 1, spaceBetween: 10 },\n            768: { slidesPerView: 2, spaceBetween: 20 },\n            1024: { slidesPerView: 3, spaceBetween: 30 },\n        }\n    });\n}\n"],"names":["document","addEventListener","container","getElementById","console","warn","hasAttribute","setAttribute","enableSearch","getAttribute","layout","maxVideos","parseInt","selectedPlaylist","apiUrlBase","fetchVideos","searchQuery","cacheKey","cachedVideos","fetch","encodeURIComponent","then","res","json","length","apiUrl","YT_FOR_WP","channelId","apiKey","response","data","method","headers","body","JSON","stringify","key","videos","items","error","searchContainer","createElement","classList","add","searchBar","type","placeholder","searchButton","textContent","event","preventDefault","click","keyword","value","trim","renderVideos","appendChild","initialVideos","existingVideoContainer","querySelector","remove","videoContainer","forEach","video","videoElement","title","snippet","description","videoId","id","resourceId","videoUrl","innerHTML","renderCarouselLayout","map","join","Swiper","slidesPerView","spaceBetween","navigation","nextEl","prevEl","pagination","el","clickable","loop","breakpoints"],"sourceRoot":""}